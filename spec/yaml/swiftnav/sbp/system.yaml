# Copyright (C) 2015 Swift Navigation Inc.
# Contact: Fergus Noble <fergus@swiftnav.com>
#
# This source is subject to the license found in the file 'LICENSE' which must
# be be distributed together with this source. All other rights reserved.
#
# THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
# EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.

package: swiftnav.sbp.system
description: Standardized system messages from Swift Navigation devices.
stable: True
public: True
include:
  - types.yaml
definitions:

 - MSG_STARTUP:
    id: 0xFF00
    short_desc: System start-up message
    desc: |
        The system start-up message is sent once on system
        start-up. It notifies the host or other attached devices that
        the system has started and is now ready to respond to commands
        or configuration requests.
    fields:
        - cause:
            type: u8
            desc: Cause of startup
            fields:
              - 0-8:
                  desc: Cause of startup
                  values:
                    - 0: Power on
                    - 1: Software reset
                    - 2: Watchdog reset
        - startup_type:
            type: u8
            desc: Startup type
            fields:
              - 0-8:
                  values:
                    - 0: Cold start
                    - 1: Warm start
                    - 2: Hot start

        - reserved:
            type: u16
            desc: Reserved

 - MSG_DGNSS_STATUS:
    id: 0xFF02
    short_desc: Status of received corrections
    desc: |
        This message provides information about the receipt of Differential
        corrections.  It is expected to be sent with each receipt of a complete
        corrections packet.
    fields:
        - flags:
            type: u8
            desc: Status flags
            fields:
              - 4-7:
                  desc: Reserved
              - 0-3:
                  desc: Differential type
                  values:
                      - 0: Invalid
                      - 1: Code Difference
                      - 2: RTK
        - latency:
            type: u16
            units: deci-seconds
            desc: Latency of observation receipt
        - num_signals:
            type: u8
            desc: Number of signals from base station
        - source:
            type: string
            desc: Corrections source string


 - MSG_HEARTBEAT:
    id: 0xFFFF
    short_desc: System heartbeat message
    desc: |
        The heartbeat message is sent periodically to inform the host
        or other attached devices that the system is running. It is
        used to monitor system malfunctions. It also contains status
        flags that indicate to the host the status of the system and
        whether it is operating correctly. Currently, the expected
        heartbeat interval is 1 sec.

        The system error flag is used to indicate that an error has
        occurred in the system. To determine the source of the error,
        the remaining error flags should be inspected.
    fields:
        - flags:
            type: u32
            desc: Status flags
            fields:
              - 31:
                  desc: External antenna present
                  values:
                      - 0: No external antenna detected
                      - 1: External antenna is present
              - 30:
                  desc: External antenna short
                  values:
                      - 0: No short detected
                      - 1: Short detected
              - 24-29:
                  desc: Reserved
              - 16-23:
                  desc: SBP major protocol version number
              - 8-15:
                  desc: SBP minor protocol version number
              - 3-7:
                  desc: Reserved
              - 2:
                  desc: SwiftNAP Error
                  values:
                      - 0: System Healthy
                      - 1: An error has occurred in the SwiftNAP
              - 1:
                  desc: IO Error
                  values:
                      - 0: System Healthy
                      - 1: An IO error has occurred
              - 0:
                  desc: System Error Flag
                  values:
                      - 0: System Healthy
                      - 1: An error has occurred

 - MSG_INS_STATUS:
    id: 0xFF03
    short_desc: Inertial Navigation System status message
    desc: |
        The INS status message describes the state of the operation
        and initialization of the inertial navigation system. 
    fields:
        - flags:
            type: u32
            desc: Status flags
            fields:
              - 29-31:
                  desc: INS Type
                  values:
                      - 0: Smoothpose Loosely Coupled
                      - 1: Other Loosely Coupled
                      - 2: Reserved
                      - 3: Reserved
                      - 4: Reserved
                      - 5: Reserved
                      - 6: Reserved
                      - 7: Reserved
              - 11-28:
                  desc: Reserved
              - 10:
                  desc: Odometry Synch
                  values:
                      - 0: Odometry timestamp nominal
                      - 1: Odometry timestamp out of bounds
              - 8-9:
                  desc: Odometry status
                  values:
                      - 0: No Odometry
                      - 1: Odometry received within last second
                      - 2: Odometry not received within last second
              - 4-7:
                  desc:  INS Error
                  values:
                      - 0: Reserved
                      - 1: IMU Data Error
                      - 2: INS License Error
                      - 3: IMU Calibration Data Error
              - 3:
                  desc: GNSS Fix
                  values:
                      - 0: No GNSS fix available
                      - 1: GNSS fix
              - 0-2:
                  desc: Mode
                  values:
                      - 0: Awaiting initialization
                      - 1: Dynamically aligning
                      - 2: Ready
                      - 3: GNSS Outage exceeds max duration
                      - 4: FastStart seeding
                      - 5: FastStart validating
                  
 - MSG_CSAC_TELEMETRY:
    id: 0xFF04
    short_desc: Experimental telemetry message
    public: false
    desc: |
        The CSAC telemetry message has an implementation defined telemetry string
        from a device. It is not produced or available on general Swift Products.
        It is intended to be a low rate message for status purposes.
    fields:
        - id:
            type: u8
            desc: Index representing the type of telemetry in use.  It is implemention defined.
        - telemetry:
            type: string
            desc: Comma separated list of values as defined by the index

 - MSG_CSAC_TELEMETRY_LABELS:
    id: 0xFF05
    short_desc: Experimental telemetry message labels
    public: false
    desc: |
        The CSAC telemetry message provides labels for each member of the string
        produced by MSG_CSAC_TELEMETRY. It should be provided by a device at a lower
        rate than the MSG_CSAC_TELEMETRY.
    fields:
        - id:
            type: u8
            desc: Index representing the type of telemetry in use.  It is implemention defined.
        - telemetry_labels:
            type: string
            desc: Comma separated list of telemetry field values

 - MSG_INS_UPDATES:
    id: 0xFF06
    short_desc: Inertial Navigation System update status message
    public: false
    desc: |
        The INS update status message contains informations about executed and rejected INS updates.
        This message is expected to be extended in the future as new types of measurements are being added.
    fields:
        - tow:
            type: u32
            units: ms
            desc: GPS Time of Week
        - gnsspos:
            type: u8
            desc: GNSS position update status flags
            fields:
              - 4-7:
                  desc: Number of attempted GNSS position updates since last message.
              - 0-3:
                  desc: Number of rejected GNSS position updates since last message.
        - gnssvel:
            type: u8
            desc: GNSS velocity update status flags
            fields:
              - 4-7:
                  desc: Number of attempted GNSS velocity updates since last message.
              - 0-3:
                  desc: Number of rejected GNSS velocity updates since last message.
        - wheelticks:
            type: u8
            desc: Wheelticks update status flags
            fields:
              - 4-7:
                  desc: Number of attempted wheeltick updates since last message.
              - 0-3:
                  desc: Number of rejected wheeltick updates since last message.
        - speed:
            type: u8
            desc: Wheelticks update status flags
            fields:
              - 4-7:
                  desc: Number of attempted speed updates since last message.
              - 0-3:
                  desc: Number of rejected speed updates since last message.
        - nhc:
            type: u8
            desc: NHC update status flags
            fields:
              - 4-7:
                  desc: Number of attempted NHC updates since last message.
              - 0-3:
                  desc: Number of rejected NHC updates since last message.
        - zerovel:
            type: u8
            desc: Zero velocity update status flags
            fields:
              - 4-7:
                  desc: Number of attempted zero velocity updates since last message.
              - 0-3:
                  desc: Number of rejected zero velocity updates since last message.
                  
 - MSG_GNSS_TIME_OFFSET:
    id: 0xFF07
    short_desc: Offset of the local time with respect to GNSS time
    desc: |
        The GNSS time offset message contains the information that is needed to translate messages
        tagged with a local timestamp (e.g. IMU or wheeltick messages) to GNSS time for the sender
        producing this message.
    fields:
        - weeks:
            type: s16
            units: weeks
            desc: Weeks portion of the time offset
        - milliseconds:
            type: s32
            units: ms
            desc: Milliseconds portion of the time offset
        - microseconds:
            type: s16
            units: microseconds
            desc: Microseconds portion of the time offset
        - flags:
            type: u8
            desc: Status flags (reserved)

 - MSG_GROUP_META:
     id: 0xFF0A
     short_desc: Solution Group Metadata
     public: true
     desc: |
       This leading message lists the time metadata of the Solution Group.
       It also lists the atomic contents (i.e. types of messages included) of the Solution Group.
     fields:
       - wn:
           type: u16
           units: weeks
           desc: GPS Week Number or zero if Reference epoch is not GPS
       - tom:
           type: u32
           units: ms
           desc: Time of Measurement in Milliseconds since reference epoch
       - ns_residual:
           type: s32
           units: ns
           desc: |
             Nanosecond residual of millisecond-rounded TOM (ranges
             from -500000 to 500000)
       - flags:
           type: u8
           desc: Status flags (reserved)
           fields:
             - 4-7:
                 desc: Reserved
             - 2-3:
                 desc: Solution Group type
                 values:
                   - 0: None (invalid)
                   - 1: GNSS only
                   - 2: GNSS+INS (Fuzed)
                   - 3: Reserved
             - 0-1:
                 desc: Time source
                 values:
                   - 0: Reference epoch is start of current GPS week
                   - 1: Reference epoch is Sensor Time Init
                   - 2: Reference epoch is unknown
                   - 3: Reference epoch is last PPS
       - group_msgs:
           type: array
           fill: u16
           desc: An inorder list of message types included in the Solution Group

 - GNSSInputType:
     id: 0xFFE7
     short_desc: Flags for a given GNSS sensor used as input for the fuzed solution.
     public: true
     desc: |
       Metadata around the GNSS sensors involved in the fuzed solution.
       Note: Just to build descriptive tables in documentation and not actually used.
     fields:
       - flags:
           type: u8
           desc: flags that store all relevant info specific to this sensor type.
           fields:
             - 0-1:
                 desc: Type of GNSS measurement
                 values:
                   - 0: GNSS Position
                   - 1: GNSS Velocity Doppler
                   - 2: GNSS Velocity Displacement
             - 2-7:
                 desc: Reserved

  # for IMU sensors
 - IMUInputType:
     id: 0xFFE8
     short_desc: Flags for a given IMU sensor used as input for the fuzed solution.
     public: true
     desc: |
       Metadata around the IMU sensors involved in the fuzed solution.
       Note: Just to build descriptive tables in documentation and not actually used.
     fields:
       - flags:
           type: u8
           desc: flags that store all relevant info specific to this sensor type.
           fields:
             - 0-1:
                 desc: IMU architecture
                 values:
                   - 0: 6-axis MEMS
                   - 1: other type
             - 2-3:
                 desc: IMU Grade
                 values:
                   - 0: Consumer Grade
                   - 1: Tactical grade
                   - 2: Intermediate Grade
                   - 3: Superior (Marine / Aviation) Grade
             - 4-5:
                 desc: Time status
                 values:
                   - 0: Reference epoch is start of current GPS week
                   - 1: Reference epoch is time of system startup
                   - 2: Reference epoch is unknown
                   - 3: Reference epoch is last PPS
             - 6-7:
                 desc: Reserved

  # for Odometry sensors
 - OdoInputType:
     id: 0xFFE9
     short_desc: Flags for a given Odometry sensor used as input for the fuzed solution.
     public: true
     desc: |
       Metadata around the Odometry sensors involved in the fuzed solution.
       Note: Just to build descriptive tables in documentation and not actually used.
     fields:
       - flags:
           type: u8
           desc: flags that store all relevant info specific to this sensor type.
           fields:
             - 0-1:
                 desc: Odometer class
                 values:
                   - 0: single or averaged ticks
                   - 1: single or averaged speed
                   - 2: multi-dimensional ticks
                   - 3: multi-dimensional speed
             - 2-3:
                 desc: Odometer grade
                 values:
                   - 0: Low Grade (e.g. quantisized CAN)
                   - 1: Medium Grade
                   - 2: Superior Grade
                   - 3: Reserved
             - 4-5:
                 desc: Rate
                 values:
                   - 0: Fixed incoming rate
                   - 1: Incoming when triggered by minimum distance or speed
                   - 2: Reserved
                   - 3: Reserved
             - 6-7:
                 desc: Reserved

  # the actual type of the elements going into the array solution_inputs in MSG_SOLN_META
 - SolutionInputType:
     short_desc: Flags for a given solution input type.
     desc: |
       Metadata describing which sensors were involved in the solution.
       The structure is fixed no matter what the actual sensor type is.
       The sensor_type field tells you which sensor we are talking about. It also tells you
       whether the sensor data was actually used or not.
       The flags field, always a u8, contains the sensor-specific data.
       The content of flags, for each sensor type, is described in the relevant structures in this section.
#     type: u16
     fields:
       - sensor_type:
           type: u8
           desc: The type of sensor
           fields:
             - 0-2:
                 desc: The type of sensor
                 values:
                   - 0: GNSS Position (see GNSSInputType)
                   - 1: GNSS Velocity Displacement (see GNSSInputType)
                   - 2: GNSS Velocity Doppler (see GNSSInputType)
                   - 3: Odometry Ticks (see OdoInputType)
                   - 4: Odometry Speed (see OdoInputType)
                   - 5: IMU Sensor (see IMUInputType)
                   - 6: Reserved
                   - 7: Reserved
             - 3-4:
                 desc: Whether this sensor input was actually used or not
                 values:
                   - 0: unknown
                   - 1: received and used
                   - 2: received but not used
             - 5-7:
                 desc: Reserved
       - flags:
           type: u8
           units: <Sensor>InputType
           desc: Refer to each InputType description

 - MSG_SOLN_META:
     id: 0xFF0F
     short_desc: Solution Sensors Metadata
     public: true
     desc: |
       This message contains all metadata about the sensors received and/or used in computing the Fuzed Solution.
       It focuses primarly, but not only, on GNSS metadata.
     fields:
       - pdop:
           type: u16
           units: 0.01
           desc: Position Dilution of Precision, as per last received DOPS,
             even if the GNSS solutions are not used in computing the Fuzed Solution.
       - hdop:
           type: u16
           units: 0.01
           desc: Horizontal Dilution of Precision, as per last received DOPS,
             even if the GNSS solutions are not used in computing the Fuzed Solution.
       - vdop:
           type: u16
           units: 0.01
           desc: Vertical Dilution of Precision, as per last received DOPS,
             even if the GNSS solutions are not used in computing the Fuzed Solution.
       - n_sats:
           type: u8
           desc: Number of satellites used in solution, as per last received GNSS solutions,
             even if the GNSS solutions are not used in computing the Fuzed Solution.
       - age_of_corrections:
           type: u16
           units: deciseconds
           desc: Age of the corrections (0xFFFF indicates invalid), as per last received MSG_AGE_CORRECTIONS,
             even if the GNSS solutions are not used in computing the Fuzed Solution.
       - alignment_status:
           type: u8
           desc: Bits for reason why it cannot align (yet)
           fields:
             - 0-2:
                 desc: Bits for reason why it cannot align (yet)
                 values:
                   - 0: Unknown reason or already aligned
                   - 1: No seed values nor GNSS measurements
                   - 2: Seed values loaded but not GNSS measurements
                   - 3: Reserved
                   - 4: Reserved
                   - 5: Reserved
                   - 6: Reserved
                   - 7: Reserved
             - 3-7:
                 desc: Reserved
       - last_used_gnss_pos_tow:
           type: u32
           units: ms
           desc: Tow of last-used GNSS position measurement
       - last_used_gnss_vel_tow:
           type: u32
           units: ms
           desc: Tow of last-used GNSS velocity measurement
       - solution_inputs:
           type: array
           fill: SolutionInputType
           desc: Array of Metadata describing the sensors potentially involved in the solution.
             Each element in the array represents a single sensor type and consists of flags containing (meta)data
             pertaining to that specific single sensor. Refer to each <Sensor>InputType descriptor in the present doc.
